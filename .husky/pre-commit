echo "🔐 Running detect-secrets..."

# Stash changes for staged files only
FILES=$(git diff --cached --name-only)

if [ -z "$FILES" ]; then
  echo "✅ No files staged for commit."
  exit 0
fi

# Scan only staged files using detect-secrets scan
detect-secrets scan $FILES

if [ $? -ne 0 ]; then
  echo "❌ Potential secrets detected! Commit aborted."
  exit 1
else
  echo "✅ No secrets detected."
fi
